<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Teio æœåŠ¡å™¨ - æˆ˜ç»©ä¸­å¿ƒ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --main-green: #4CAF50; --dark-bg: #121212; --card-bg: #1e1e1e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: white; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        h1 { text-align: center; color: var(--main-green); }
        .match-card { background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 30px; border-top: 4px solid var(--main-green); }
        .match-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #333; }
        th { color: var(--main-green); }
        .rating-box { font-weight: bold; padding: 4px 8px; border-radius: 4px; }
        .high { background: #2e7d32; }
        .low { background: #c62828; }
        .btn-back { display: inline-block; margin-bottom: 20px; color: var(--main-green); text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn-back">â† è¿”å›ä¸»é¡µ</a>
        <h1>ğŸ“Š å†å²æˆ˜ç»©æ’è¡Œ (Rating 1.0)</h1>
        <div id="matches-list">æ­£åœ¨åŠ è½½æˆ˜ç»©å†å²...</div>
    </div>

    <script>
        // Rating è®¡ç®—å…¬å¼ (æ¥è¿‘ HLTV 1.0)
        // å‡è®¾ MR12 (24å›åˆ)ï¼Œå¦‚æœCSVé‡Œæ²¡ç»™å›åˆæ•°ï¼Œé»˜è®¤å–24
        function calcRating(p) {
            const rounds = 24; 
            const adr = p.damage / rounds;
            const kpr = p.kills / rounds;
            const dpr = p.deaths / rounds;
            
            // åŸºç¡€ Rating å…¬å¼
            let rating = ( (kpr / 0.679) + ( (1 - dpr) / 0.683 ) + (adr / 90) ) / 3;
            
            // å¤šæ€åŠ æˆ
            const multiKillBonus = (p.enemy2ks * 0.05 + p.enemy3ks * 0.15 + p.enemy4ks * 0.3 + p.enemy5ks * 0.5) / rounds;
            return (rating + multiKillBonus).toFixed(2);
        }

        async function loadMatches() {
            try {
                // è¯»å– matches.json (ç”±æœ¬åœ°è„šæœ¬ç”Ÿæˆ)
                const response = await fetch('data/matches.json');
                const matchList = await response.json();
                
                [cite_start]// æŒ‰ MatchID ä»æ–°åˆ°æ—§æ’åº [cite: 12]
                matchList.sort((a, b) => b.id - a.id);

                const container = document.getElementById('matches-list');
                container.innerHTML = '';

                for (const match of matchList) {
                    const csvData = await fetch(`data/${match.file}`).then(r => r.text());
                    const results = Papa.parse(csvData, { header: true, dynamicTyping: true });
                    
                    renderMatch(match, results.data);
                }
            } catch (e) {
                document.getElementById('matches-list').innerHTML = "æš‚æ— å†å²æˆ˜ç»©ï¼Œè¯·ç¡®ä¿å·²è¿è¡Œæœ¬åœ°è„šæœ¬å¹¶ä¸Šä¼  data/matches.json";
            }
        }

        function renderMatch(match, players) {
            // è¿‡æ»¤æ‰ç©ºè¡Œ
            players = players.filter(p => p.name);
            // æŒ‰ Rating æ’åº
            players.forEach(p => p.rating = calcRating(p));
            players.sort((a, b) => b.rating - a.rating);

            let html = `
                <div class="match-card">
                    <div class="match-header">
                        <span>æ¯”èµ› ID: #${match.id}</span>
                        <span>åœ°å›¾: ${players[0].team.replace('team_', '')} vs ...</span>
                    </div>
                    <table>
                        <tr><th>ç©å®¶</th><th>K/D/A</th><th>ADR</th><th>å¤šæ€(2/3/4/5)</th><th>Rating</th></tr>
            `;

            players.forEach(p => {
                const ratingClass = p.rating >= 1.0 ? 'high' : 'low';
                html += `
                    <tr>
                        <td>${p.name}</td>
                        <td>${p.kills}/${p.deaths}/${p.assists}</td>
                        <td>${(p.damage/24).toFixed(1)}</td>
                        <td>${p.enemy2ks}/${p.enemy3ks}/${p.enemy4ks}/${p.enemy5ks}</td>
                        <td><span class="rating-box ${ratingClass}">${p.rating}</span></td>
                    </tr>
                `;
            });

            html += `</table></div>`;
            document.getElementById('matches-list').innerHTML += html;
        }

        loadMatches();
    </script>
</body>
</html>
